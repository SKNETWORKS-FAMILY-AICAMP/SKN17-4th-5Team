{% extends "frontend/base.html" %}
{% load static %}

{% block content %}
<div class="wrapper">
  <!-- 사이드바 -->
  <aside class="sidebar">
    <button class="hamburger" id="hamburger">☰</button>
    <div class="brand">AI Driving Assistance</div>

    <div class="chat-list">
      <div class="chat-title">채팅</div>
      <ul>
        <li class="chat-item">방금 고라니를 쳤...</li>
        <li class="chat-item">비가 너무 많이 오...</li>
      </ul>
      <button class="new-chat">새 채팅</button>
    </div>
  </aside>

  <!-- 메인 페이지 -->
  <main class="main-area">
    <header class="topbar">
      <div class="drive-mode">
        <label>리서치 모드</label>
        <div class="toggle" id="driveToggle"></div>
      </div>

      <div class="user-actions">
        {% if is_authenticated %}
          <div class="profile-circle" id="profileBtn">{{ user_email|slice:":2"|upper }}</div>
        {% else %}
          <button class="btn login" id="loginBtn">로그인</button>
          <button class="btn signup" id="signupBtn">회원가입</button>
        {% endif %}
      </div>
    </header>

    <section class="hero">
      <h1>운전에 관한 모든 걸 물어보세요</h1>
      {% if not is_authenticated %}
        <p class="hint">채팅을 하려면 로그인을 해주세요.</p>
      {% endif %}
    </section>

    {% if is_authenticated %}
    <section class="chat-area">
      <div class="messages">
        <div class="message bot">채팅을 시작해주세요.</div>
      </div>

      <div class="chat-input-wrapper">
        <div class="chat-input">
          <input type="text" placeholder="메시지를 입력하세요..." id="chatInput" />
          <button id="micBtn" class="mic" style="display: none;">
            <i class="fa-solid fa-microphone"></i>
          </button>
          <button id="sendBtn" class="send-btn">전송</button>
        </div>
      </div>
    </section>
    {% endif %}
  </main>
</div>

<!-- 모달 백드롭 -->
<div id="modalBackdrop" class="modal-backdrop hidden"></div>

<!-- 로그인 모달 -->
<div id="loginModal" class="modal hidden">
  <div class="modal-inner">
    <button class="modal-close" data-close="loginModal">X</button>
    <h2>로그인</h2>
    
    <form id="loginForm">
      <label>이메일</label>
      <input type="email" name="email" placeholder="you@example.com" required>
      <label>비밀번호</label>
      <input type="password" name="password" placeholder="비밀번호를 입력하세요" required>
      <div id="loginError" class="error-message hidden" style="color: red; text-align: center; margin: 10px 0;"></div>

      <button type="submit" class="primary">로그인</button>
      <a href="#" id="forgotPassword">비밀번호 찾기</a>
    </form>
  </div>
</div>


<!-- 회원가입 모달 -->
<div id="signupModal" class="modal hidden">
  <div class="modal-inner">
    <button class="modal-close" data-close="signupModal">X</button>
    <h2>회원가입</h2>
    <form id="signupForm">
      <label>이메일</label>
      <div style="display: flex; gap: 10px;">
        <input type="email" placeholder='you@example.com' name="email" id="email" style="flex: 1;">
        <button type="button" id="sendCode">중복확인</button>
      </div>
      <div id="emailMessage" class="error-message" style="color: red; margin: 5px 0;"></div>

      <label>인증번호</label>
      <div style="display: flex; gap: 10px;">
        <input name="code" placeholder='인증번호를 입력하세요.' id="codeInput" style="flex: 0.8;">
        <button type="button" id="verifyCodeBtn" style="width: 50px;">확인</button>
      </div>


      <label>비밀번호</label>
      <input type="password" placeholder='숫자, 영소문자 포함 6자' name="pwd">

      <label>비밀번호 확인</label>
      <input type="password" placeholder = '확인' name="pwd2">

      <button type="submit" class="primary">회원가입</button>
    </form>
  </div>
</div>

<!-- 프로필 모달 (회원정보) -->
<div id="profileModal" class="modal hidden">
  <div class="modal-inner">
    <button class="modal-close" data-close="profileModal">X</button>
    <h2>회원정보</h2>
    <div class="profile-info">
      <div class="info-row">
        <span class="info-label">Email</span>
        <span class="info-value">{{ user_email }}</span>
      </div>
      <div class="info-row">
        <span class="info-label">PWD</span>
        <span class="info-value">••••••••</span>
      </div>
    </div>
    <div class="profile-actions">
      <button id="logoutBtn" class="profile-btn outline">로그아웃</button>
      <button id="changePwdBtn" class="profile-btn filled">비밀번호 변경</button>
      <button id="withdrawBtn" class="profile-btn link">회원 탈퇴</button>
    </div>
  </div>
</div>

<!-- 회원 탈퇴 확인 모달 -->

<div id="withdrawModal" class="modal hidden">
  <div class="modal-inner">
    <button class="modal-close" data-close="withdrawModal">✕</button>
    <h2>회원 탈퇴</h2>
    <form id="withdrawForm">
      <label>비밀번호</label>
      <input 
        type="password" 
        id="withdrawPassword" 
        placeholder="숫자, 영소문자 포함 6자" 
        required
      />
      <div id="withdrawError" class="error-message hidden"></div>
      <button type="submit" class="primary">탈퇴하기</button>
    </form>
  </div>
</div>

<!-- 탈퇴 확인 모달 -->
<div id="withdrawConfirmModal" class="modal hidden">
  {# 스타일 비슷한건 클래스 줘서 묶어서 처리하는 방향으로 #}
  <div class="modal-inner" style="text-align: center; padding: 40px 30px;">
    <h2 style="font-size: 20px; margin-bottom: 15px;">탈퇴 하시겠습니까?</h2>
    <p style="color: #666; font-size: 14px; margin-bottom: 5px;">탈퇴 버튼 선택 시, 계정은</p>
    <p style="color: #666; font-size: 14px; margin-bottom: 5px;">삭제되며 복구되지 않습니다.</p>
    <div style="display: flex; gap: 10px;">
      <button 
        type="button" 
        onclick="closeWithdrawConfirm()" 
        style="flex: 1; padding: 14px; background: #e9ecef; color: #495057; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer;"
      >
        취소
      </button>
      <button 
        type="button" 
        onclick="confirmWithdrawAction()" 
        style="flex: 1; padding: 14px; background: #6366f1; color: white; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer;"
      >
        탈퇴
      </button>
    </div>
  </div>
</div>

<!-- 탈퇴 완료 모달 -->
<div id="withdrawSuccessModal" class="modal hidden">
  <div class="modal-inner" style="text-align: center; padding: 40px 30px;">
    <div style="font-size: 48px; margin-bottom: 20px;">✓</div>
    <h2 style="font-size: 20px; margin-bottom: 30px;">탈퇴가 완료되었습니다</h2>
    <button 
      type="button" 
      onclick="goToHome()" 
      style="width: 100%; padding: 14px; background: #6366f1; color: white; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer;"
    >
      확인
    </button>
  </div>
</div>


<!-- 비밀번호 변경 모달 -->
<div id="changePwdModal" class="modal hidden">
  <div class="modal-inner">
    <button class="modal-close" data-close="changePwdModal">X</button>
    <h2>비밀번호 변경</h2>
    <form id="changePwdForm">
      <div class="form-group">
        <label>기존 비밀번호</label>
        <input type="password" id="oldPassword" placeholder="숫자, 영문자 포함 6자" required>
        <span id="oldPwdError" class="field-error hidden"></span>
        <span id="oldPwdSuccess" class="field-success hidden">인증 완료</span>
      </div>
      
      <div class="form-group">
        <label>새 비밀번호</label>
        <input type="password" id="newPassword" placeholder="숫자, 영문자 포함 6자" required disabled>
        <span id="newPwdError" class="field-error hidden"></span>
      </div>
      
      <div class="form-group">
        <label>새 비밀번호 재확인</label>
        <input type="password" id="confirmPassword" placeholder="숫자, 영문자 포함 6자" required disabled>
        <span id="confirmPwdError" class="field-error hidden"></span>
        <span id="confirmPwdSuccess" class="field-success hidden">인증 완료</span>
      </div>
      
      <button type="submit" class="primary" id="submitPwdChange" disabled>변경하기</button>
    </form>
  </div>
</div>

{% endblock %}