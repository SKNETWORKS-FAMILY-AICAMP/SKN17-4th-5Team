{% extends "frontend/base.html" %}
{% load static %}

{% block content %}
<div class="wrapper">
  <!-- ì‚¬ì´ë“œë°” -->
  <aside class="sidebar">
    <button class="hamburger" id="hamburger">â˜°</button>
    <div class="brand">AI Driving Assistance</div>

    <div class="chat-list">
      <div class="chat-title">ì±„íŒ…</div>
      <ul>
        <li class="chat-item">ë°©ê¸ˆ ê³ ë¼ë‹ˆë¥¼ ì³¤...</li>
        <li class="chat-item">ë¹„ê°€ ë„ˆë¬´ ë§ì´ ì˜¤...</li>
      </ul>
      <button class="new-chat">ìƒˆ ì±„íŒ…</button>
    </div>
  </aside>

  <!-- ë©”ì¸ í˜ì´ì§€ -->
  <main class="main-area">
    <header class="topbar">
      <div class="drive-mode">
        <label>ë¦¬ì„œì¹˜ ëª¨ë“œ</label>
        <div class="toggle" id="driveToggle"></div>
      </div>

      <div class="user-actions">
        {% if is_authenticated %}
          <div class="profile-circle" id="profileBtn">{{ user_email|slice:":2"|upper }}</div>
        {% else %}
          <button class="btn login" id="loginBtn">ë¡œê·¸ì¸</button>
          <button class="btn signup" id="signupBtn">íšŒì›ê°€ì…</button>
        {% endif %}
      </div>
    </header>

    <section class="hero">
      <h1>ìš´ì „ì— ê´€í•œ ëª¨ë“  ê±¸ ë¬¼ì–´ë³´ì„¸ìš”</h1>
      {% if not is_authenticated %}
        <p class="hint">ì±„íŒ…ì„ í•˜ë ¤ë©´ ë¡œê·¸ì¸ì„ í•´ì£¼ì„¸ìš”.</p>
      {% endif %}
    </section>

    {% if is_authenticated %}
    <section class="chat-area">
      <div class="messages">
        <div class="message bot">ì±„íŒ…ì„ ì‹œì‘í•´ì£¼ì„¸ìš”.</div>
      </div>

      <div class="chat-input-wrapper">
        <div class="chat-input">
          <input type="text" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." id="chatInput" />
          <button id="micBtn" class="mic" style="display: none;">ğŸ¤</button>
          <button id="sendBtn" class="send-btn">ì „ì†¡</button>
        </div>
      </div>
    </section>
    {% endif %}
  </main>
</div>

<!-- ëª¨ë‹¬ ë°±ë“œë¡­ -->
<div id="modalBackdrop" class="modal-backdrop hidden"></div>

<!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
<div id="loginModal" class="modal hidden">
  <div class="modal-inner">
    <button class="modal-close" data-close="loginModal">X</button>
    <h2>ë¡œê·¸ì¸</h2>
    
    <form id="loginForm">
      <label>ì´ë©”ì¼</label>
      <input type="email" name="email" placeholder="you@example.com" required>
      <label>ë¹„ë°€ë²ˆí˜¸</label>
      <input type="password" name="password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
      <div id="loginError" class="error-message hidden" style="color: red; text-align: center; margin: 10px 0;"></div>

      <button type="submit" class="primary">ë¡œê·¸ì¸</button>
      <a href="#" id="forgotPassword">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
    </form>
  </div>
</div>

<!-- íšŒì›ê°€ì… ëª¨ë‹¬ -->
<div id="signupModal" class="modal hidden">
  <div class="modal-inner">
    <button class="modal-close" data-close="signupModal">X</button>
    <h2>íšŒì›ê°€ì…</h2>
    <form id="signupForm" method="post">
      <label>ì´ë©”ì¼</label>
      <input type="email" name="email" id="email">
      <div id="emailMessage" class="error-message" style="color: red; margin: 5px 0;"></div>
      <button type="button" id="sendCode">ì¤‘ë³µí™•ì¸</button>

      <label>ì¸ì¦ë²ˆí˜¸</label>
      <div style="display: flex; gap: 10px;">
        <input name="code" id="codeInput">
        <button type="button" id="verifyCodeBtn">í™•ì¸</button>
      </div>

      <label>ë¹„ë°€ë²ˆí˜¸</label>
      <input type="password" name="pwd">

      <label>ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
      <input type="password" name="pwd2">

      <button type="submit" class="primary">íšŒì›ê°€ì…</button>
    </form>
  </div>
</div>

<!-- í”„ë¡œí•„ ëª¨ë‹¬ -->
<div id="profileModal" class="modal hidden">
  <div class="modal-inner">
    <button class="modal-close" data-close="profileModal">X</button>
    <h2>ë§ˆì´í˜ì´ì§€</h2>
    <p>Email: {{ user_email }}</p>
    <div class="profile-actions">
      <button id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
      <button id="changePwdBtn">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
      <button id="withdrawBtn">íšŒì› íƒˆí‡´</button>
    </div>
  </div>
</div>
{% endblock %}